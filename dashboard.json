{
    "title": "Property Management Portal Splunk Monitoring Board",
    "description": "",
    "inputs": {
        "input_DateTime": {
            "options": {
                "defaultValue": "-24h@h,now",
                "token": "dateTimeRange"
            },
            "title": "Date/Time Range",
            "type": "input.timerange"
        },
        "input_Environement": {
            "options": {
                "defaultValue": "corp_digital_pm_qa",
                "items": [
                    {
                        "label": "All",
                        "value": "corp_digital_pm_*"
                    },
                    {
                        "label": "DEV",
                        "value": "corp_digital_pm_dev"
                    },
                    {
                        "label": "QA",
                        "value": "corp_digital_pm_qa"
                    },
                    {
                        "label": "PROD",
                        "value": "corp_digital_pm_prod"
                    }
                ],
                "token": "env"
            },
            "title": "Select the Environment",
            "type": "input.dropdown"
        }
    },
    "defaults": {
        "dataSources": {
            "ds.search": {
                "options": {
                    "queryParameters": {}
                }
            }
        }
    },
    "visualizations": {
        "viz_apiPerfLegend": {
            "options": {
                "markdown": "### ðŸ“˜ API Performance Legend\n\n**Major Value (sec)**\n- Shows *current* p95 response time in seconds.\n- This is the latest p95 value in the selected time range.\n\n**Trend (% Change)**\n- Measures *relative degradation or improvement* vs the APIâ€™s own average for the selected period.\n- **Positive %** â†’ API is *slower* than its typical performance.\n- **Negative %** â†’ API is *faster* (improved).\n\n**Color Scale (Based on Trend %)**\n- **ðŸŸ© Green** â†’ Trend â‰¤ 0% (performing better or equal to baseline)\n- **ðŸŸ¨ Yellow** â†’ 0% to 20% (slightly slower than baseline)\n- **ðŸŸ§ Orange** â†’ 20% to 170% (moderate degradation)\n- **ðŸŸ¥ Red** â†’ 170% to 500%+ (major degradation)\n\n**Ordering**\n- APIs are sorted by *highest degradation first*, so worst-performing APIs appear at the top-left.\n"
            },
            "title": "Legend: How to Read This Panel",
            "type": "splunk.markdown"
        },
        "viz_apiPerformance": {
            "context": {
                "backgroundColorEditorConfig": [
                    {
                        "to": 0,
                        "value": "#1C6B2D"
                    },
                    {
                        "from": 0,
                        "to": 20,
                        "value": "#FFCC00"
                    },
                    {
                        "from": 20,
                        "to": 70,
                        "value": "#FF9900"
                    },
                    {
                        "from": 70,
                        "to": 120,
                        "value": "#FF6600"
                    },
                    {
                        "from": 120,
                        "to": 170,
                        "value": "#FF3300"
                    },
                    {
                        "from": 170,
                        "to": 220,
                        "value": "#FF0000"
                    },
                    {
                        "from": 220,
                        "to": 270,
                        "value": "#CC0000"
                    },
                    {
                        "from": 270,
                        "to": 320,
                        "value": "#990000"
                    },
                    {
                        "from": 320,
                        "to": 370,
                        "value": "#800000"
                    },
                    {
                        "from": 370,
                        "to": 420,
                        "value": "#660000"
                    },
                    {
                        "from": 420,
                        "to": 470,
                        "value": "#4D0000"
                    },
                    {
                        "from": 470,
                        "value": "#330000"
                    }
                ]
            },
            "dataSources": {
                "primary": "ds_apiPerformance"
            },
            "options": {
                "backgroundColor": "> trendValue | rangeValue(backgroundColorEditorConfig)",
                "majorValue": "> sparklineValues | lastPoint()",
                "numberPrecision": 1,
                "showSparkline": true,
                "showTrendIndicator": true,
                "sparklineValues": "> primary | seriesByName(\"p95_sec\")",
                "splitByLayout": "trellis",
                "trellisColumns": 5,
                "trellisMinColumnWidth": 260,
                "trellisRowHeight": 150,
                "trellisSplitBy": "api_path",
                "trendDisplay": "percent",
                "trendValue": "> primary | seriesByName(\"trend_pct\") | lastPoint()",
                "unit": " sec"
            },
            "title": "API Performance (Relative to Selected Period)",
            "type": "splunk.singlevalue"
        },
        "viz_apisTraficArea": {
            "dataSources": {
                "primary": "ds_apisTrafic"
            },
            "options": {
                "legend": {
                    "position": "right"
                },
                "legendDisplay": "off",
                "stackMode": "stacked",
                "xAxisTitleText": "timeperiod"
            },
            "title": "API Traffic",
            "type": "splunk.area"
        },
        "viz_existingRegistrationFailure": {
            "dataSources": {
                "primary": "ds_registrationStats"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "majorValue": "> sparklineValues | lastPoint()",
                "primaryValue": "existing_failure",
                "showSparkline": false,
                "showTrendIndicator": false,
                "sparklineValues": "> primary | seriesByName('existing_failure')",
                "trendValue": "> sparklineValues | delta(-2)"
            },
            "title": "Existing Registration - Failure",
            "type": "splunk.singlevalue"
        },
        "viz_existingRegistrationSuccess": {
            "dataSources": {
                "primary": "ds_registrationStats"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "majorValue": "> sparklineValues | lastPoint()",
                "primaryValue": "existing_success",
                "showSparkline": false,
                "showTrendIndicator": false,
                "sparklineValues": "> primary | seriesByName('existing_success')",
                "trendValue": "> sparklineValues | delta(-2)"
            },
            "title": "Existing Registration - Success",
            "type": "splunk.singlevalue"
        },
        "viz_loginFailures": {
            "dataSources": {
                "primary": "ds_loginMetrics"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "majorValue": "> sparklineValues | lastPoint()",
                "sparklineDisplay": "off",
                "sparklineValues": "> primary | seriesByName('total_login_failures')"
            },
            "title": "Total Login Failures",
            "type": "splunk.singlevalue"
        },
        "viz_loginMetricsTitle": {
            "options": {
                "backgroundColor": "#a575ff",
                "customFontSize": 20,
                "fontSize": "custom",
                "markdown": "Login Metrics"
            },
            "type": "splunk.markdown"
        },
        "viz_loginTotalAttempts": {
            "dataSources": {
                "primary": "ds_loginMetrics"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "majorValue": "> sparklineValues | lastPoint()",
                "sparklineDisplay": "off",
                "sparklineValues": "> primary | seriesByName('total_login_attempts')"
            },
            "title": "Total Login Attempts",
            "type": "splunk.singlevalue"
        },
        "viz_loginUniqueUsers": {
            "dataSources": {
                "primary": "ds_loginMetrics"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "majorValue": "> sparklineValues | lastPoint()",
                "sparklineDisplay": "off",
                "sparklineValues": "> primary | seriesByName('unique_logged_in_users')"
            },
            "title": "Unique Logged-in Users",
            "type": "splunk.singlevalue"
        },
        "viz_mostUsedApisArea": {
            "dataSources": {
                "primary": "ds_mostUsedApis"
            },
            "options": {
                "legend": {
                    "position": "right"
                },
                "stackMode": "stacked",
                "xAxisTitleText": "timeline",
                "y": "> primary | frameBySeriesNames('/addlocations','/cancelpendingremoval','/getAvgMonthlyBill','/getOrderDateAvailability','/getServiceOrderHistory','/getaddressautosuggest','/getagreements','/getagreementsbypremisenumbers','/getagreementsbyssn','/getcoarsegrainedaddress','/getlocations','/getsummaryoflocations','/removelocations','/sendEmailUpdateEmail','/sendRegistrationConfirmationEmail','/submitLandlordConnect','/updateAgreement','/updateUserCommAndReports','/updateuseragreementsinfr')",
                "y2": "> primary | frameBySeriesNames('')",
                "yAxisTitleText": "count"
            },
            "title": "Most Used APIs Over Time",
            "type": "splunk.area"
        },
        "viz_newRegistrationFailure": {
            "dataSources": {
                "primary": "ds_registrationStats"
            },
            "options": {
                "majorValue": "> sparklineValues | lastPoint()",
                "primaryValue": "new_failure",
                "showSparkline": false,
                "showTrendIndicator": false,
                "sparklineValues": "> primary | seriesByName('new_failure')",
                "trendValue": "> sparklineValues | delta(-2)"
            },
            "title": "New Registration - Failure",
            "type": "splunk.singlevalue"
        },
        "viz_newRegistrationSuccess": {
            "dataSources": {
                "primary": "ds_registrationStats"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "primaryValue": "new_success",
                "showSparkline": false,
                "showTrendIndicator": false
            },
            "title": "New Registration - Success",
            "type": "splunk.singlevalue"
        },
        "viz_registrationMetricsTitle": {
            "options": {
                "backgroundColor": "#a575ff",
                "customFontSize": 20,
                "fontSize": "custom",
                "markdown": "Registration Metrics"
            },
            "type": "splunk.markdown"
        },
        "viz_topApiErrors": {
            "context": {
                "countColumnFormatEditorConfig": {
                    "number": {
                        "thousandSeparated": false,
                        "unitPosition": "after"
                    }
                },
                "errorColumnFormatEditorConfig": {
                    "string": {
                        "unitPosition": "after"
                    }
                }
            },
            "dataSources": {
                "primary": "ds_topApiErrors"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "columnFormat": {
                    "count": {
                        "align": "right",
                        "data": "> table | seriesByName(\"count\") | formatByType(countColumnFormatEditorConfig)",
                        "headerAlign": "auto",
                        "textOverflow": "ellipsis",
                        "width": 80
                    },
                    "error": {
                        "align": "auto",
                        "data": "> table | seriesByName(\"error\") | formatByType(errorColumnFormatEditorConfig)",
                        "headerAlign": "auto",
                        "textOverflow": "ellipsis"
                    }
                },
                "showColumnHeader": true,
                "showRowNumber": false,
                "tableFormat": {
                    "align": "right",
                    "headerAlign": "right"
                }
            },
            "title": "Top API Errors (Error, Count)",
            "type": "splunk.table"
        },
        "viz_topApiErrorsUrl": {
            "dataSources": {
                "primary": "ds_topApiErrorsUrl"
            },
            "eventHandlers": [
                {
                    "options": {
                        "newTab": true,
                        "type": "auto"
                    },
                    "type": "drilldown.linkToSearch"
                }
            ],
            "options": {
                "columnFormat": {
                    "count": {
                        "align": "right",
                        "data": "> table | seriesByName(\"count\") | formatByType(countColumnFormatEditorConfig)",
                        "headerAlign": "auto",
                        "textOverflow": "ellipsis",
                        "width": 80
                    },
                    "error": {
                        "align": "auto",
                        "data": "> table | seriesByName(\"error\") | formatByType(errorColumnFormatEditorConfig)",
                        "headerAlign": "auto",
                        "textOverflow": "ellipsis"
                    }
                },
                "eventHandlers": [
                    {
                        "options": {
                            "tokens": [
                                {
                                    "key": "row.api",
                                    "token": "drill_api"
                                },
                                {
                                    "key": "row.error",
                                    "token": "drill_error"
                                }
                            ]
                        },
                        "type": "drilldown.setToken"
                    }
                ],
                "showColumnHeader": true,
                "showRowNumber": false,
                "tableFormat": {
                    "align": "right",
                    "headerAlign": "right"
                }
            },
            "title": "Top API Errors With Url (API, Error, Count)",
            "type": "splunk.table"
        }
    },
    "dataSources": {
        "ds_apiPerformance": {
            "name": "ApiPerformanceSearch",
            "options": {
                "query": "index=$env$\r\n| spath\r\n| spath path=file output=f\r\n| search f=\"SplunkInterceptor\"\r\n| spath path=sourcetype output=st\r\n| search st=\"pmp:api:logs\"\r\n| spath path=apiDetails.url output=api_url\r\n| eval api_path = replace(api_url, \"https?://[^/]+\", \"\")\r\n| eval api_path = replace(api_path, \"\\?.*$\", \"\")\r\n| eval api_path = if(isnull(api_path) OR api_path=\"\", \"NULL\", api_path)\r\n| spath path=apiDetails.elapsedTime output=elapsed_time\r\n| eval elapsed_time = tonumber(elapsed_time)\r\n| eval elapsed_time_sec = elapsed_time / 1000.0\r\n| bin _time span=10m\r\n| stats \r\n    avg(elapsed_time_sec) AS avg_sec_raw\r\n    perc95(elapsed_time_sec) AS p95_sec_raw\r\n    perc99(elapsed_time_sec) AS p99_sec_raw\r\n  BY api_path _time\r\n| eval avg_sec = round(avg_sec_raw, 1)\r\n| eval p95_sec = round(p95_sec_raw, 1)\r\n| eval p99_sec = round(p99_sec_raw, 1)\r\n| eventstats avg(p95_sec) AS period_p95_avg BY api_path\r\n| eval trend_pct = if(period_p95_avg > 0,\r\n                      round(((p95_sec - period_p95_avg) / period_p95_avg) * 100, 1),\r\n                      0)\r\n| eventstats latest(p95_sec) AS current_p95_sec BY api_path\r\n| sort - trend_pct",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_apisTrafic": {
            "name": "ApisTrafficSearch",
            "options": {
                "query": "index=$env$\n| spath\n| spath path=file output=f\n| search f=\"SplunkInterceptor\"\n| spath path=sourcetype output=st\n| search st=\"pmp:api:logs\"\n| spath path=apiDetails.url output=api_url\n| eval api_path = replace(api_url, \"https?://[^/]+\", \"\")\n| eval api_path = replace(api_path, \"\\?.*$\", \"\")\n| eval api_path = if(isnull(api_path) OR api_path=\"\", \"NULL\", api_path)\n| timechart span=1h count",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_errorDrilldown": {
            "name": "ErrorDrilldownSearch",
            "options": {
                "query": "index=$env$\n| spath\n| spath path=file output=f\n| search f=\"SplunkInterceptor\"\n| spath path=sourcetype output=st\n| search st=\"pmp:api:logs\"\n| spath path=level output=logLevel\n| search logLevel=\"ERROR\"\n| spath path=apiDetails.url output=api\n| spath path=apiDetails.body.errorDetails.errorDetails.message output=err_msg_deep\n| spath path=apiDetails.body.errorDetails.errorDetails.code output=err_code_deep\n| spath path=apiDetails.body.errorDetails.errorDetails.type output=err_type_deep\n| spath path=apiDetails.body.errorDetails.error output=err_msg_simple\n| spath path=apiDetails.body.code output=err_code_simple\n| spath path=apiDetails.body.type output=err_type_simple\n| spath path=apiDetails.body{}.report.message output=report_err_msgs\n| spath path=apiDetails.body.statusCode output=statusCode\n| spath path=apiDetails.correlationID output=correlationID\n| spath path=username output=username\n| spath path=sessionID output=sessionID\n| eval api = if(isnull(api) OR api=\"\", \"NULL\", api)\n| eval error_raw = coalesce(err_msg_deep, err_msg_simple, mvindex(report_err_msgs, 0))\n| eval error_raw = if(error_raw=\"\", null(), error_raw)\n| eval error = coalesce(\n    error_raw,\n    err_type_deep . \" (code=\" . err_code_deep . \")\",\n    err_type_simple . \" (code=\" . err_code_simple . \")\",\n    \"UNKNOWN_ERROR\"\n  )\n| where \"$drill_api$\"=\"ALL_APIS\" OR api=\"$drill_api$\"\n| search error=\"$drill_error$\"\n| table _time, api, error, statusCode, logLevel, apiDetails.body, correlationID, username, sessionID\n| sort - _time",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_loginMetrics": {
            "name": "LoginMetricsSearch",
            "options": {
                "query": "index=$env$\n| spath\n| spath path=file output=f\n| search f=\"SignInRedirectCallbackComponent\"\n| search level=\"INFO\" OR level=\"ERROR\"\n| eval email = coalesce(email, userEmail, username, user)\n| eval is_failure = if(level=\"ERROR\", 1, 0)\n| eval success_email = if(level=\"INFO\" AND is_failure=0, email, null())\n| stats count AS total_login_attempts\n        sum(is_failure) AS total_login_failures\n        dc(success_email) AS unique_logged_in_users",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_mostUsedApis": {
            "name": "MostUsedApisSearch",
            "options": {
                "query": "index=$env$\n| spath\n| spath path=file output=f\n| search f=\"SplunkInterceptor\"\n| spath path=sourcetype output=st\n| search st=\"pmp:api:logs\"\n| spath path=apiDetails.url output=api_url\n| eval api_path = replace(api_url, \"https?://[^/]+\", \"\")\n| eval api_path = replace(api_path, \"\\?.*$\", \"\")\n| eval api_path = if(isnull(api_path) OR api_path=\"\", \"NULL\", api_path)\n| timechart span=1h count BY api_path limit=30",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_registrationStats": {
            "name": "RegistrationStatsSearch",
            "options": {
                "query": "index=$env$\n| spath\n| spath path=file output=f\n| search f=\"SplunkInterceptor\"\n| spath path=sourcetype output=st\n| search st=\"pmp:api:logs\"\n| spath path=apiDetails.url output=api_url\n| spath path=apiDetails.success output=api_success\n| spath path=apiDetails.body.success output=body_success\n| spath path=apiDetails.body.statusCode output=body_statusCode\n| spath path=apiDetails.headers.isNewRegistration output=isNewRegistration_raw\n| eval api_path = replace(api_url, \"https?://[^/]+\", \"\")\n| eval api_path = replace(api_path, \"\\\\?.*$\", \"\")\n| where like(api_path, \"/updateuseragreementsinfr%\")\n| eval api_success_flag = lower(tostring(api_success))\n| eval body_success_flag = lower(tostring(body_success))\n| eval body_statusCode = tonumber(body_statusCode)\n| eval outcome = case(\n    api_success_flag==\"true\" OR body_success_flag==\"true\",  \"Success\",\n    api_success_flag==\"false\" OR body_success_flag==\"false\", \"Failure\",\n    body_statusCode>=200 AND body_statusCode<300,              \"Success\",\n    body_statusCode>=400,                                      \"Failure\",\n    true(),                                                     \"Other\")\n| eval isNew_flag = lower(tostring(isNewRegistration_raw))\n| eval registrationType = case(\n    isNew_flag==\"true\" OR isNew_flag==\"1\",  \"New\",\n    isNew_flag==\"false\" OR isNew_flag==\"0\", \"Existing\",\n    true(),                                      \"Existing\")\n| stats \n    count(eval(registrationType==\"New\"      AND outcome==\"Success\"))   as new_success,\n    count(eval(registrationType==\"New\"      AND outcome==\"Failure\"))   as new_failure,\n    count(eval(registrationType==\"Existing\" AND outcome==\"Success\"))   as existing_success,\n    count(eval(registrationType==\"Existing\" AND outcome==\"Failure\"))   as existing_failure",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_topApiErrors": {
            "name": "TopApiErrorsSearch",
            "options": {
                "query": "index=$env$\n| spath\n| spath path=file output=f\n| search f=\"SplunkInterceptor\"\n| spath path=sourcetype output=st\n| search st=\"pmp:api:logs\"\n| spath path=level output=logLevel\n| search logLevel=\"ERROR\"\n\n| spath path=apiDetails.url output=api\n\n| spath path=apiDetails.body.errorDetails.errorDetails.message output=err_msg_deep\n| spath path=apiDetails.body.errorDetails.errorDetails.code output=err_code_deep\n| spath path=apiDetails.body.errorDetails.errorDetails.type output=err_type_deep\n\n| spath path=apiDetails.body.errorDetails.error output=err_msg_simple\n\n| spath path=apiDetails.body.code output=err_code_simple\n| spath path=apiDetails.body.type output=err_type_simple\n\n| spath path=apiDetails.body{}.report.message output=report_err_msgs\n\n| eval api = if(isnull(api) OR api=\"\", \"NULL\", api)\n\n| eval error_raw = coalesce(\n    err_msg_deep,\n    err_msg_simple,\n    mvindex(report_err_msgs, 0)\n)\n| eval error_raw = if(error_raw=\"\", null(), error_raw)\n\n| eval error_full = coalesce(\n    error_raw,\n    err_type_deep . \" (code=\" . err_code_deep . \")\",\n    err_type_simple . \" (code=\" . err_code_simple . \")\",\n    \"UNKNOWN_ERROR\"\n)\n\n| rex field=error_full \"Root error type\\s*:\\s*(?<error_root_type>[^,]+)\"\n| rex field=error_full \"failed:\\s*(?<error_failed_reason>[^.]+)\"\n| rex field=error_full \"Bad Request:\\s*(?<error_bad_reason>[^.]+)\"\n| rex field=error_full \"ORA-(?<ora_code>\\d+):\\s*(?<ora_msg>.*)\"\n\n| eval error = case(\n    isnotnull(error_bad_reason),\n      error_bad_reason,\n\n    isnotnull(error_failed_reason),\n      error_failed_reason,\n\n    isnotnull(ora_code),\n      \"ORA-\" . ora_code . \": \" . ora_msg,\n\n    like(error_full, \"There is no non-service accounts for the client.%\"),\n      \"There is no non-service accounts for the client.\",\n\t  \n    true(),\n      error_full\n)\n| stats count AS count BY error\n| sort - count",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        },
        "ds_topApiErrorsUrl": {
            "name": "TopApiErrorsWithUrlSearch",
            "options": {
                "query": "index=$env$\n| spath\n| spath path=file output=f\n| search f=\"SplunkInterceptor\"\n| spath path=sourcetype output=st\n| search st=\"pmp:api:logs\"\n| spath path=level output=logLevel\n| search logLevel=\"ERROR\"\n\n| spath path=apiDetails.url output=api_url\n\n| spath path=apiDetails.body.errorDetails.errorDetails.message output=err_msg_deep\n| spath path=apiDetails.body.errorDetails.errorDetails.code output=err_code_deep\n| spath path=apiDetails.body.errorDetails.errorDetails.type output=err_type_deep\n\n| spath path=apiDetails.body.errorDetails.error output=err_msg_simple\n\n| spath path=apiDetails.body.code output=err_code_simple\n| spath path=apiDetails.body.type output=err_type_simple\n\n| spath path=apiDetails.body{}.report.message output=report_err_msgs\n| eval api = replace(api_url, \"https?://[^/]+\", \"\")\n| eval api = replace(api, \"\\?.*$\", \"\")\n| eval api = if(isnull(api) OR api=\"\", \"NULL\", api)\n| eval api = if(isnull(api) OR api=\"\", \"NULL\", api)\n\n| eval error_raw = coalesce(\n    err_msg_deep,\n    err_msg_simple,\n    mvindex(report_err_msgs, 0)\n)\n| eval error_raw = if(error_raw=\"\", null(), error_raw)\n\n| eval error_full = coalesce(\n    error_raw,\n    err_type_deep . \" (code=\" . err_code_deep . \")\",\n    err_type_simple . \" (code=\" . err_code_simple . \")\",\n    \"UNKNOWN_ERROR\"\n)\n\n| rex field=error_full \"Root error type\\s*:\\s*(?<error_root_type>[^,]+)\"\n| rex field=error_full \"failed:\\s*(?<error_failed_reason>[^.]+)\"\n| rex field=error_full \"Bad Request:\\s*(?<error_bad_reason>[^.]+)\"\n| rex field=error_full \"ORA-(?<ora_code>\\d+):\\s*(?<ora_msg>.*)\"\n\n| eval error = case(\n    isnotnull(error_bad_reason),\n      error_bad_reason,\n\n    isnotnull(error_failed_reason),\n      error_failed_reason,\n\n    isnotnull(ora_code),\n      \"ORA-\" . ora_code . \": \" . ora_msg,\n\n    like(error_full, \"There is no non-service accounts for the client.%\"),\n      \"There is no non-service accounts for the client.\",\n\t  \n    true(),\n      error_full\n)\n| stats count AS count BY api, error\n| sort - count",
                "queryParameters": {
                    "earliest": "$dateTimeRange.earliest$",
                    "latest": "$dateTimeRange.latest$"
                }
            },
            "type": "ds.search"
        }
    },
    "layout": {
        "globalInputs": [
            "input_DateTime",
            "input_Environement"
        ],
        "layoutDefinitions": {
            "layout_1": {
                "options": {
                    "height": 2200,
                    "width": 1440
                },
                "structure": [
                    {
                        "item": "viz_loginMetricsTitle",
                        "position": {
                            "h": 40,
                            "w": 1440,
                            "x": 0,
                            "y": 0
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_loginTotalAttempts",
                        "position": {
                            "h": 200,
                            "w": 480,
                            "x": 0,
                            "y": 40
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_registrationMetricsTitle",
                        "position": {
                            "h": 40,
                            "w": 1440,
                            "x": 0,
                            "y": 240
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_newRegistrationSuccess",
                        "position": {
                            "h": 200,
                            "w": 360,
                            "x": 0,
                            "y": 280
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_topApiErrors",
                        "position": {
                            "h": 500,
                            "w": 720,
                            "x": 0,
                            "y": 480
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_apisTraficArea",
                        "position": {
                            "h": 500,
                            "w": 720,
                            "x": 0,
                            "y": 980
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_apiPerformance",
                        "position": {
                            "h": 900,
                            "w": 1440,
                            "x": 0,
                            "y": 1480
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_apiPerfLegend",
                        "position": {
                            "h": 400,
                            "w": 1440,
                            "x": 0,
                            "y": 2380
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_newRegistrationFailure",
                        "position": {
                            "h": 200,
                            "w": 360,
                            "x": 360,
                            "y": 280
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_loginFailures",
                        "position": {
                            "h": 200,
                            "w": 480,
                            "x": 480,
                            "y": 40
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_existingRegistrationSuccess",
                        "position": {
                            "h": 200,
                            "w": 360,
                            "x": 720,
                            "y": 280
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_topApiErrorsUrl",
                        "position": {
                            "h": 500,
                            "w": 720,
                            "x": 720,
                            "y": 480
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_mostUsedApisArea",
                        "position": {
                            "h": 500,
                            "w": 720,
                            "x": 720,
                            "y": 980
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_loginUniqueUsers",
                        "position": {
                            "h": 200,
                            "w": 480,
                            "x": 960,
                            "y": 40
                        },
                        "type": "block"
                    },
                    {
                        "item": "viz_existingRegistrationFailure",
                        "position": {
                            "h": 200,
                            "w": 360,
                            "x": 1080,
                            "y": 280
                        },
                        "type": "block"
                    }
                ],
                "type": "grid"
            }
        },
        "options": {
            "submitButton": false
        },
        "tabs": {
            "items": [
                {
                    "label": "New tab",
                    "layoutId": "layout_1"
                }
            ]
        }
    }
}
